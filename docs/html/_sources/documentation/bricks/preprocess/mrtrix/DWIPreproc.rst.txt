:orphan:

.. toctree::

+--------------------------------+----------------------------------------------+----------------------------------------------------+
|`Home <../../../../index.html>`_|`Documentation <../../../documentation.html>`_|`GitHub <https://github.com/populse/mia_processes>`_|
+--------------------------------+----------------------------------------------+----------------------------------------------------+

=================
DWIPreproc brick
=================

Perform diffusion image pre-processing using FSL’s topup and eddy tool
----------------------------------------------------------------------

Run topup and Eddy to pre-processe DWI image ncluding inhomogeneity distortion correction using FSL’s topup tool if possible.

FSL should be configured in populse.

(mrtrix dwifslpreproc command)

*Please note that, in mia_processes, MRtrix bricks required diffusion data in MRtrix .mif format.
The MRConvert brick could be used to convert diffusion data in NIfTI format into MRtrix .mif format.
In this case, bvec and bval file should be specified.*

--------------------------------------

**Mandatory inputs parameters:**

- *in_file* (a pathlike object or a string representing an existing file)
    Input DWI image (valid extensions: [.mif, .nii, .nii.gz]).

    ::

      ex. '/home/username/data/raw_data/DWI.mif'

**Optional inputs with default value parameters:**

- *rpe_option* (none, pair, all or header, default value is none, optional)
    | Specify acquisition phase-encoding design:
    |   - none: if no reversed phase-encoding image available
    |   - all: if DWIs data have been acquired with opposing phase-encoding
    |   - pair: if a set of image (typically b=0 volumes with opposing phase-direction) has been acquired for inhomogeneity field estimation only

    ::

      ex. pair

- *se_epi_corr* (a pathlike object or a string representing an existing file, optional)
    An additional image series consisting of spin-echo EPI images (typically b=0 volumes with opposing phase-direction)
    which is to be used exclusively by topup for estimating the inhomogeneity field (i.e. it will not form part of the output image series)

    If rpe_option is set to pair, the se_epi_corr image series contains one or more pairs of b=0 images with reversed phase encoding,
    the FIRST HALF of the volumes in the SE-EPI series must possess the same phase encoding as the input DWI series,
    while the second half are assumed to contain the opposite phase encoding direction but identical total readout time.

    ::

      ex. '/home/username/data/raw_data/DWI_b0_inverse_phase.mif

- *pe_dir* (ap, pa, lr, rl, default value is ap, optional)
    | Phase encoding direction of the input serie using an axis designator:
    |   - ap : Anterior to posterior
    |   - pa: Posterior to anterior
    |   - lr: Left to right
    |   - rl: Right toleft

    ::

      ex. ap

- *align_seepi* (a boolean, default value is False, optional)
    Achieve alignment between the images used for inhomogeneity field estimation, and the input DWI

    ::

      ex. False

- *eddyqc_all* (a boolean, default value is False, optional)
    Keep ALL outputs generated by eddy (including images), and the output of eddy_qc (if installed)

    ::

      ex. False

- *eddyqc_text* (a boolean, default value is False, optional)
    Keep the various text-based statistical outputs generated by eddy (including images), and the output of eddy_qc (if installed)

    ::

      ex. False

- *nocleanup* (a boolean, default value is False, optional)
    Do not delete intermediate files during script execution, and do not delete scratch directory at script completion.

    ::

      ex. False


**Optional inputs parameters:**

- *ro_time* (a float, optional)
    Total readout time of input series (in seconds).

    ::

      ex. 2.0

- *eddy_mask* (a pathlike object or a string representing an existing file, optional)
    A mask to use for eddy. If not used, a mask will be automaticcaly
    generated by this brick using mrtrix dwi2mask command

    ::

      ex. '/home/username/data/raw_data/DWI_brain_mask.nii'

- *eddy_option* (a string, optional)
    Additional command-line options to the eddy command.

    ::

      ex. '--slm=linear --repol --data_is_shelled'

- *eddy_slspec* (a pathlike object or a string representing an existing file, optional)
    A file containing slice groupings for eddy’s slice-to-volume registration

    ::

      ex. '/home/username/data/raw_data/registration.nii'

- *topup_option* (a string, optional)
    Additional command-line options to the topup command

    ::

      ex. '--scale=1'

**Outputs parameters:**

- *out_file* (a pathlike object or string representing a file)
    The output preprocessed DWI image

    ::

      ex. '/home/username/data/derived_data/DWI_fslpreproc.mif'


-------------

Usefull links:

`mrtrix dwipreproc <https://mrtrix.readthedocs.io/en/latest/reference/commands/dwifslpreproc.html#dwifslpreproc>`_

`mrtrix dwipreproc - nipype <https://nipype.readthedocs.io/en/latest/api/generated/nipype.interfaces.mrtrix3.preprocess.html#dwipreproc>`_

`FSL Topup <https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/topup/TopupUsersGuide>`_

`FSL Eddy <https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/eddy/UsersGuide>`_
