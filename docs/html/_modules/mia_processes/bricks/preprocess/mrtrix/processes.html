<!DOCTYPE html>

<html lang="en" data-content_root="../../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mia_processes.bricks.preprocess.mrtrix.processes &#8212; mia_processes 2.5.1-dev+d2eab655 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=f63d8bfa" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/haiku.css?v=e491ac2d" />
    <script src="../../../../../_static/documentation_options.js?v=667fb608"></script>
    <script src="../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../../../../index.html">
          <span>mia_processes 2.5.1-dev+d2eab655 documentation</span></a></h1>
        <h2 class="heading"><span>mia_processes.bricks.preprocess.mrtrix.processes</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for mia_processes.bricks.preprocess.mrtrix.processes</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;The mrtrix (mrtrix3) preprocess library of the mia_processes package.</span>

<span class="sd">The purpose of this module is to customise the main mrtrix preprocessing bricks</span>
<span class="sd">provided by nipype and to correct some things that do not work directly in</span>
<span class="sd">populse_mia.</span>

<span class="sd">:Contains:</span>
<span class="sd">    :Class:</span>
<span class="sd">        - ConstrainedSphericalDeconvolution</span>
<span class="sd">        - DWIBiasCorrect</span>
<span class="sd">        - DWIBrainMask</span>
<span class="sd">        - DWIDenoise</span>
<span class="sd">        - DWIExtract</span>
<span class="sd">        - DWIPreproc</span>
<span class="sd">        - EditingTrack</span>
<span class="sd">        - FitTensor</span>
<span class="sd">        - FilteringTrack</span>
<span class="sd">        - Generate5ttfsl</span>
<span class="sd">        - Generate5tt2gmwmi</span>
<span class="sd">        - MRCat</span>
<span class="sd">        - MRConvert</span>
<span class="sd">        - MRDeGibbs</span>
<span class="sd">        - MRMath</span>
<span class="sd">        - MRTransform</span>
<span class="sd">        - MTNormalise</span>
<span class="sd">        - ResponseSDDhollander</span>
<span class="sd">        - SphericalHarmonicExtraction</span>
<span class="sd">        - TensorMetrics</span>
<span class="sd">        - Tractography</span>
<span class="sd">        - TransformFSLConvert</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">##########################################################################</span>
<span class="c1"># mia_processes - Copyright (C) IRMaGe/CEA, 2018</span>
<span class="c1"># Distributed under the terms of the CeCILL license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">##########################################################################</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">capsul.in_context</span> <span class="kn">import</span> <span class="n">mrtrix</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces.base</span> <span class="kn">import</span> <span class="n">File</span><span class="p">,</span> <span class="n">InputMultiPath</span><span class="p">,</span> <span class="n">OutputMultiPath</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pipeline_manager.process_mia</span> <span class="kn">import</span> <span class="n">ProcessMIA</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Bool</span><span class="p">,</span>
    <span class="n">Either</span><span class="p">,</span>
    <span class="n">Enum</span><span class="p">,</span>
    <span class="n">Float</span><span class="p">,</span>
    <span class="n">Int</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Range</span><span class="p">,</span>
    <span class="n">String</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Undefined</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">mia_processes.utils</span> <span class="kn">import</span> <span class="n">checkFileExt</span>

<span class="c1"># for diffusion, in order to simplify the bricks,</span>
<span class="c1"># we only accept mif data (with bvec/bval inside the .mif)</span>
<span class="n">EXT_DWI</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MIF&quot;</span><span class="p">:</span> <span class="s2">&quot;mif&quot;</span><span class="p">}</span>
<span class="n">EXT</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;NIFTI_GZ&quot;</span><span class="p">:</span> <span class="s2">&quot;nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;NIFTI&quot;</span><span class="p">:</span> <span class="s2">&quot;nii&quot;</span><span class="p">,</span> <span class="s2">&quot;MIF&quot;</span><span class="p">:</span> <span class="s2">&quot;mif&quot;</span><span class="p">}</span>
<span class="n">EXT_TCK</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;TCK&quot;</span><span class="p">:</span> <span class="s2">&quot;tck&quot;</span><span class="p">}</span>


<div class="viewcode-block" id="ConstrainedSphericalDeconvolution">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.ConstrainedSphericalDeconvolution">[docs]</a>
<span class="k">class</span> <span class="nc">ConstrainedSphericalDeconvolution</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Estimate fibre orientation distributions from diffusion data using</span>
<span class="sd">    spherical deconvolution (dwi2fod command)*</span>

<span class="sd">    Please, see the complete documentation for the</span>
<span class="sd">    `ConstrainedSphericalDeconvolution brick in the</span>
<span class="sd">    mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/ConstrainedSphericalDeconvolution.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ConstrainedSphericalDeconvolution.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.ConstrainedSphericalDeconvolution.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ConstrainedSphericalDeconvolution</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input DWI image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optional inputs description</span>
        <span class="n">wm_txt_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;WM response text file.&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">csf_txt_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;CSF response text file.&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">gm_txt_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;GM response text file.&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">algorithm_desc</span> <span class="o">=</span> <span class="s2">&quot;FOD alogorithm (csd or msmt_csd)&quot;</span>
        <span class="n">in_directions_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify the directions over which to apply the non-negativity &quot;</span>
            <span class="s2">&quot;constraint (by default, the built-in 300 direction set is used).&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">in_mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Only perform computation within the specified binary brain mask &quot;</span>
            <span class="s2">&quot;image.(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">max_sh_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Maximum harmonic degree of response function (one by shell) &quot;</span>
            <span class="s2">&quot;(a list of items which are an integer) &quot;</span>
        <span class="p">)</span>
        <span class="n">get_predicted_signal_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Get a file with the predicted signal from the FOD &quot;</span>
            <span class="s2">&quot;estimates (only for msmt_csd algorithm)&quot;</span>
            <span class="s2">&quot;(a boolean) &quot;</span>
        <span class="p">)</span>
        <span class="n">shell_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify one or more b-values to use during processing&quot;</span>
            <span class="s2">&quot;(a list of items which are a float)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Output descriptions</span>
        <span class="n">predicted_signal_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Out predicted signal &quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">csf_odf_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output CSF ODF.&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">gm_odf_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output GM ODF.&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">wm_odf_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output WM ODF.&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing a file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;wm_txt&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">wm_txt_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Optionnal inouts traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;gm_txt&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">gm_txt_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;csf_txt&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">csf_txt_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;algorithm&quot;</span><span class="p">,</span>
            <span class="n">Enum</span><span class="p">(</span>
                <span class="s2">&quot;csd&quot;</span><span class="p">,</span>
                <span class="s2">&quot;msmt_csd&quot;</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">algorithm_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_directions&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_directions_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_mask&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_mask_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;max_sh&quot;</span><span class="p">,</span>
            <span class="n">List</span><span class="p">(</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">max_sh_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;shell&quot;</span><span class="p">,</span>
            <span class="n">List</span><span class="p">(</span>
                <span class="n">Float</span><span class="p">(),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">shell_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_predicted_signal&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_predicted_signal_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Ouputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;csf_odf&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">csf_odf_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;gm_odf&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">gm_odf_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;wm_odf&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">wm_odf_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;predicted_signal_file&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">predicted_signal_file_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span>
            <span class="s2">&quot;nipype.interfaces.mrtrix3.ConstrainedSphericalDeconvolution&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ConstrainedSphericalDeconvolution.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.ConstrainedSphericalDeconvolution.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ConstrainedSphericalDeconvolution</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT_DWI</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;csf_odf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_csf_odf.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;gm_odf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_gm_odf.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;wm_odf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_wm_odf.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predicted_signal</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;predicted_signal_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                        <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_odf_predicted_signal.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;csf_odf&quot;</span><span class="p">,</span> <span class="s2">&quot;gm_odf&quot;</span><span class="p">,</span> <span class="s2">&quot;wm_odf&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predicted_signal</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span>
                    <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;predicted_signal_file&quot;</span><span class="p">],</span>
                <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="ConstrainedSphericalDeconvolution.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.ConstrainedSphericalDeconvolution.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ConstrainedSphericalDeconvolution</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">wm_odf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wm_odf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">wm_txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wm_txt</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_txt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">gm_odf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_odf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">gm_txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_txt</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">csf_txt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">csf_odf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csf_odf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">csf_txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csf_txt</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predicted_signal</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">==</span> <span class="s2">&quot;msmt_csd&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">predicted_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_signal_file</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_directions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_directions</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">mask_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_sh</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">max_sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_sh</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="DWIBiasCorrect">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIBiasCorrect">[docs]</a>
<span class="k">class</span> <span class="nc">DWIBiasCorrect</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Perform B1 field inhomogeneity correction for a DWI volume series.</span>
<span class="sd">    (dwibiascorrect command)*</span>

<span class="sd">    Please, see the complete documentation for the `DWIBiasCorrect brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/DWIBiasCorrect.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DWIBiasCorrect.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIBiasCorrect.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIBiasCorrect</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="c1"># FIXME : ants and fsl in the requirement even if we use only</span>
        <span class="c1"># one of them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">,</span> <span class="s2">&quot;ants&quot;</span><span class="p">,</span> <span class="s2">&quot;fsl&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input DWI image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionnal inputs description</span>
        <span class="n">use_fsl_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Use FSL FAST to estimate the inhomogeneity field. (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">use_ants_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Use ANTS N4 to estimate the inhomogeneity field. (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">bias_desc</span> <span class="o">=</span> <span class="s2">&quot;Get bias field (a boolean)&quot;</span>
        <span class="n">in_mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input mask image for bias field estimation (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="c1"># Output descriptions</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The output bias corrected DWI image (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">bias_field_map_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The output bias field map (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;use_fsl&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">use_fsl_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;use_ants&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">use_ants_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;bias&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">bias_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_mask&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">in_mask_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;bias_field_map&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">bias_field_map_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.DWIBiasCorrect&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DWIBiasCorrect.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIBiasCorrect.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIBiasCorrect</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ants</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_fsl</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;use_ants and use_fsl are mutually exclusif&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT_DWI</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_unbias.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;bias_field_map&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                        <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_bias_field_map.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span>
                    <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;bias_field_map&quot;</span><span class="p">],</span>
                <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="DWIBiasCorrect.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIBiasCorrect.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIBiasCorrect</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_fsl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">use_fsl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_fsl</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="s2">&quot;use_ants&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">optional</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ants</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">use_ants</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ants</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="s2">&quot;use_fsl&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">optional</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_field_map</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="DWIBrainMask">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIBrainMask">[docs]</a>
<span class="k">class</span> <span class="nc">DWIBrainMask</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Generates a whole brain mask from a DWI image.</span>
<span class="sd">    (dwi2mask command)*</span>

<span class="sd">    Please, see the complete documentation for the `DWIBrainMask brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/DWIBrainMask.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DWIBrainMask.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIBrainMask.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIBrainMask</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input DWI image (a pathlike object&quot;</span>
            <span class="s2">&quot;or a string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Output descriptions</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output brain mask (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.BrainMask&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DWIBrainMask.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIBrainMask.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIBrainMask</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT_DWI</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_brainmask.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="DWIBrainMask.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIBrainMask.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIBrainMask</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="DWIDenoise">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIDenoise">[docs]</a>
<span class="k">class</span> <span class="nc">DWIDenoise</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Denoise DWI data and estimate the noise level based on the optimal</span>
<span class="sd">    threshold for PCA. (dwi denoise command)*</span>

<span class="sd">    Please, see the complete documentation for the `DWIDenoise brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/DWIDenoise.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DWIDenoise.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIDenoise.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIDenoise</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input DWI image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionnal inputs description</span>
        <span class="n">extend_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Set the window size of the denoising filter. &quot;</span>
            <span class="s2">&quot; (a tuple of the form: (an integer, an integer, an integer), &quot;</span>
            <span class="s2">&quot;default = 5,5,5) &quot;</span>
        <span class="p">)</span>
        <span class="n">mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Only process voxels within the specified binary brain mask &quot;</span>
            <span class="s2">&quot;image (a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">noise_desc</span> <span class="o">=</span> <span class="s2">&quot;Get noise map (a boolean)&quot;</span>
        <span class="c1"># Outputs traits description</span>
        <span class="n">noise_map_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The output noise map (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The output denoised DWI image (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;extend&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Int</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Int</span><span class="p">),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">extend_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;noise&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">noise_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;mask&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">mask_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;noise_map&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">noise_map_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.DWIDenoise&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DWIDenoise.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIDenoise.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIDenoise</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT_DWI</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_denoised.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;noise_map&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                        <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_noise_map.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;noise_map&quot;</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="DWIDenoise.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIDenoise.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIDenoise</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">extend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extend</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_map</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="DWIExtract">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIExtract">[docs]</a>
<span class="k">class</span> <span class="nc">DWIExtract</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Extract diffusion-weighted volumes, b=0 volumes,</span>
<span class="sd">    or certain shells from a DWI dataset (dwiextract command)*</span>

<span class="sd">    Please, see the complete documentation for the `DWIExtract brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/tools/mrtrix/DWIExtract.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DWIExtract.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIExtract.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIExtract</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optional inputs description</span>
        <span class="n">bzero_desc</span> <span class="o">=</span> <span class="s2">&quot;Extract b=0 volume (a boolean)&quot;</span>
        <span class="n">nobzero_desc</span> <span class="o">=</span> <span class="s2">&quot;Extract non b=0 volume (a boolean)&quot;</span>
        <span class="n">shell_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify one or more gradient shells &quot;</span>
            <span class="s2">&quot;(a list of items which are a float)&quot;</span>
        <span class="p">)</span>
        <span class="n">singleshell_desc</span> <span class="o">=</span> <span class="s2">&quot;Extract volumes with a specific shell (a boolean)&quot;</span>

        <span class="c1"># Output description</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output image (a pathlike object or string representing &quot;</span>
            <span class="s2">&quot;an existing file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Optional inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;bzero&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">bzero_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;nobzero&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">nobzero_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;shell&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">List</span><span class="p">(</span><span class="n">Float</span><span class="p">()),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">shell_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;singleshell&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">singleshell_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.DWIExtract&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DWIExtract.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIExtract.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIExtract</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT_DWI</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobzero</span><span class="p">:</span>
                    <span class="n">fileName</span> <span class="o">+=</span> <span class="s2">&quot;_nobzero&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bzero</span><span class="p">:</span>
                    <span class="n">fileName</span> <span class="o">+=</span> <span class="s2">&quot;_bzero&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="p">:</span>
                    <span class="n">shells</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="p">)</span>
                    <span class="n">fileName</span> <span class="o">+=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">shells</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="DWIExtract.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIExtract.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIExtract</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bzero</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">bzero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bzero</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobzero</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">nobzero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobzero</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">singleshell</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">singleshell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">singleshell</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="DWIPreproc">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIPreproc">[docs]</a>
<span class="k">class</span> <span class="nc">DWIPreproc</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Perform diffusion image pre-processing using FSL’s eddy tool;</span>
<span class="sd">    including inhomogeneity distortion correction using FSL’s topup</span>
<span class="sd">    tool if possible (dwifslpreproc command)*</span>

<span class="sd">    Please, see the complete documentation for the `DWIPreproc brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/DWIPreproc.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DWIPreproc.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIPreproc.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIPreproc</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">,</span> <span class="s2">&quot;fsl&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input DWI image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">rpe_options_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify acquisition phase-encoding design. “none” for no &quot;</span>
            <span class="s2">&quot;reversed phase-encoding image, “all” for all DWIs have opposing &quot;</span>
            <span class="s2">&quot;phase-encoding acquisition, “pair” for using a pair of b0 &quot;</span>
            <span class="s2">&quot;volumes for inhomogeneity field estimation only, and “header” &quot;</span>
            <span class="s2">&quot;for phase-encoding information can be found in the image &quot;</span>
            <span class="s2">&quot;header(s). (none or pair or all or header) &quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionnal inputs description</span>
        <span class="n">align_seepi_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Achieve alignment between the SE-EPI images used for &quot;</span>
            <span class="s2">&quot;inhomogeneity field estimation, and the DWIs (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">eddy_mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Provide a processing mask to use for eddy, instead of having &quot;</span>
            <span class="s2">&quot;dwifslpreproc generate one internally using dwi2mask &quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">eddy_options_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Additional command-line options to the eddy command (a string)&quot;</span>
        <span class="p">)</span>
        <span class="n">eddy_slspec_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Provide a file containing slice groupings for eddy’s &quot;</span>
            <span class="s2">&quot;slice-to-volume registration.(a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="n">eddyqc_all_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Keep ALL outputs generated by eddy (including images), and the &quot;</span>
            <span class="s2">&quot;output of eddy_qc (if installed)&quot;</span>
            <span class="s2">&quot;(a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">eddyqc_text_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Keep the various text-based statistical outputs generated &quot;</span>
            <span class="s2">&quot;by eddy, and the output of eddy_qc (if installed), &quot;</span>
            <span class="s2">&quot;(a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">se_epi_corr_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Provide an additional image series consisting of spin-echo EPI &quot;</span>
            <span class="s2">&quot;images which is to be used exclusively by topup for estimating &quot;</span>
            <span class="s2">&quot;the  inhomogeneity field (i.e. it will not form part of the &quot;</span>
            <span class="s2">&quot;output image series) (a pathlike object or string representing &quot;</span>
            <span class="s2">&quot;an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">pe_dir_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify the phase encoding direction of the input series, &quot;</span>
            <span class="s2">&quot;can be a signed axis number (e.g. -0, 1, +2), an axis designator &quot;</span>
            <span class="s2">&quot;(e.g. RL, PA, IS), or NIfTI axis codes (e.g. i-, j, k) (a string)&quot;</span>
        <span class="p">)</span>
        <span class="n">ro_time_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Total readout time of input series (in seconds) (a float)&quot;</span>
        <span class="p">)</span>
        <span class="n">topup_options_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Additional command-line options to the topup command (a string)&quot;</span>
        <span class="p">)</span>
        <span class="n">nocleanup_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Do not delete intermediate files during script execution and do &quot;</span>
            <span class="s2">&quot;not delete scratch directory at script completion&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Output descriptions</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The output preprocessed DWI image (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;rpe_options&quot;</span><span class="p">,</span>
            <span class="n">Enum</span><span class="p">(</span>
                <span class="s2">&quot;rpe_none&quot;</span><span class="p">,</span>
                <span class="s2">&quot;rpe_pair&quot;</span><span class="p">,</span>
                <span class="s2">&quot;rpe_all&quot;</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">rpe_options_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Optionnal inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;se_epi_corr&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">se_epi_corr_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;pe_dir&quot;</span><span class="p">,</span>
            <span class="n">Enum</span><span class="p">(</span>
                <span class="s2">&quot;ap&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pa&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lr&quot;</span><span class="p">,</span>
                <span class="s2">&quot;rl&quot;</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">pe_dir_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;ro_time&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Float</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">ro_time_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;align_seepi&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">align_seepi_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;eddy_mask&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">eddy_mask_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;eddy_options&quot;</span><span class="p">,</span>
            <span class="n">String</span><span class="p">(</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">eddy_options_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;eddy_slspec&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">eddy_slspec_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;eddyqc_all&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">eddyqc_all_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;eddyqc_text&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">eddyqc_text_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;topup_options&quot;</span><span class="p">,</span>
            <span class="n">String</span><span class="p">(</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">topup_options_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;nocleanup&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">nocleanup_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.DWIPreproc&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DWIPreproc.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIPreproc.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIPreproc</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT_DWI</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                    <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_dwifslpreproc.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="DWIPreproc.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.DWIPreproc.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DWIPreproc</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span>
        <span class="n">rpe_options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rpe_all&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rpe_pair&quot;</span><span class="p">:</span> <span class="s2">&quot;pair&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rpe_none&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">rpe_options</span> <span class="o">=</span> <span class="n">rpe_options</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rpe_options</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">align_seepi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align_seepi</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">se_epi_corr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_epi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">se_epi_corr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">pe_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe_dir</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ro_time</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">ro_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ro_time</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eddy_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">eddy_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eddy_mask</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eddy_options</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">eddy_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eddy_options</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eddy_slspec</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">eddy_slspec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eddy_slspec</span>
        <span class="n">eddyqc_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_file</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_eddyqc&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eddyqc_all</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">eddyqc_all</span> <span class="o">=</span> <span class="n">eddyqc_path</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eddyqc_text</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">eddyqc_text</span> <span class="o">=</span> <span class="n">eddyqc_path</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topup_options</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">topup_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topup_options</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nocleanup</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;-nocleanup&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="EditingTrack">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.EditingTrack">[docs]</a>
<span class="k">class</span> <span class="nc">EditingTrack</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Perform various editing operations on track files.</span>
<span class="sd">    (tckedit command)*</span>

<span class="sd">    Please, see the complete documentation for the `EditingTrack brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/EditingTrack.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="EditingTrack.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.EditingTrack.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EditingTrack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_tracks_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Inputs track file(s) (a list of items which are a pathlike &quot;</span>
            <span class="s2">&quot;object or a string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">suffix_desc</span> <span class="o">=</span> <span class="s2">&quot;Output file suffix (a string)&quot;</span>
        <span class="n">roi_excl_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify an exclusion region of interest, streamlines that enter &quot;</span>
            <span class="s2">&quot;ANY exclude region will be discarded. (a pathlike &quot;</span>
            <span class="s2">&quot;object or string representing an existing file or a tuple of the &quot;</span>
            <span class="s2">&quot;form: (a float, a float, a float, a float))&quot;</span>
        <span class="p">)</span>
        <span class="n">roi_incl_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify an inclusion region of interest, streamlines must &quot;</span>
            <span class="s2">&quot;traverse ALL inclusion regions to be accepted. (a pathlike &quot;</span>
            <span class="s2">&quot;object or string representing an existing file or a tuple of the &quot;</span>
            <span class="s2">&quot;form: (a float, a float, a float, a float))&quot;</span>
        <span class="p">)</span>
        <span class="n">roi_incl_ordered_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify an inclusion region of interest, streamlines must &quot;</span>
            <span class="s2">&quot;traverse ALL inclusion_ordered regions in the order &quot;</span>
            <span class="s2">&quot;they are specified in order to be accepted. (a pathlike &quot;</span>
            <span class="s2">&quot;object or string representing an existing file or a tuple of the &quot;</span>
            <span class="s2">&quot;form: (a float, a float, a float, a float))&quot;</span>
        <span class="p">)</span>
        <span class="n">roi_mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify a masking region of interest. If defined,streamlines &quot;</span>
            <span class="s2">&quot;exiting the mask will be truncated. (a pathlike &quot;</span>
            <span class="s2">&quot;object or string representing an existing file or a tuple of the &quot;</span>
            <span class="s2">&quot;form: (a float, a float, a float, a float))&quot;</span>
        <span class="p">)</span>
        <span class="n">maxlength_desc</span> <span class="o">=</span> <span class="s2">&quot;The maximum length of any streamline in mm (a float)&quot;</span>
        <span class="n">minlength_desc</span> <span class="o">=</span> <span class="s2">&quot;The minimum length of any streamline in mm (a float)&quot;</span>
        <span class="n">number_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The desired number of selected streamlines to be propagated to &quot;</span>
            <span class="s2">&quot;the output file (an integer)&quot;</span>
        <span class="p">)</span>
        <span class="n">skip_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Omit this number of selected streamlines before commencing &quot;</span>
            <span class="s2">&quot;writing to the output file (an integer)&quot;</span>
        <span class="p">)</span>
        <span class="n">maxweight_desc</span> <span class="o">=</span> <span class="s2">&quot;The maximum weight of any streamline (an integer)&quot;</span>
        <span class="n">minweight_desc</span> <span class="o">=</span> <span class="s2">&quot;The minimum weight of any streamline (an integer)&quot;</span>
        <span class="n">inverse_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output the inverse selection of streamlines based on the &quot;</span>
            <span class="s2">&quot;criteria provided; i.e. only those streamlines that fail at &quot;</span>
            <span class="s2">&quot;least one selection criterion, and/or vertices that are outside &quot;</span>
            <span class="s2">&quot;masks if provided, will be written to file (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">ends_only_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Only test the ends of each streamline against the provided &quot;</span>
            <span class="s2">&quot;include/exclude ROIs (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">tck_weights_in_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify a text scalar file containing the streamline weights&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">get_tck_weights_out_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Get  an output text scalar file containing streamline weights &quot;</span>
            <span class="s2">&quot;(a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Output descriptions</span>
        <span class="n">tracks_out_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The output track file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">tck_weights_out_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output text scalar file containing streamline weights&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing a file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_tracks&quot;</span><span class="p">,</span>
            <span class="n">InputMultiPath</span><span class="p">(</span>
                <span class="n">Either</span><span class="p">(</span><span class="n">File</span><span class="p">(),</span> <span class="n">List</span><span class="p">(</span><span class="n">File</span><span class="p">())),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">in_tracks_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;suffix&quot;</span><span class="p">,</span>
            <span class="n">String</span><span class="p">(</span>
                <span class="s2">&quot;edited&quot;</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">suffix_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;roi_excl&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">roi_excl_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;roi_incl&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">roi_incl_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;roi_incl_ordered&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">roi_incl_ordered_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;roi_mask&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">roi_mask_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;maxlenght&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Float</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">maxlength_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;minlength&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Float</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">minlength_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;number&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">number_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;skip&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">skip_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;maxweight&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">maxweight_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;minweight&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">minweight_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;inverse&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">inverse_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;ends_only&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">ends_only_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;tck_weights_in&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">tck_weights_in_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_tck_weights_out&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_tck_weights_out_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;tracks_out&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">tracks_out_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;tck_weights_out&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">tck_weights_out_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span></div>


<div class="viewcode-block" id="EditingTrack.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.EditingTrack.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EditingTrack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">in_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">:</span>
                <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT_TCK</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="c1"># Name of the first track used for output name</span>
                <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">EXT</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;tracks_out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                    <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;tck_weights_out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_weight.txt&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="c1"># First track file used for inheritance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;tracks_out&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;tck_weights_out&quot;</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="EditingTrack.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.EditingTrack.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EditingTrack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tckedit&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">in_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="n">in_file</span><span class="p">]</span>

        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks_out</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi_excl</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-exclude&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roi_excl</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi_incl</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-include&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roi_incl</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi_incl_ordered</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-include_ordered&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roi_incl_ordered</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi_mask</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-mask&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roi_mask</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlenght</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-maxlenght&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxlenght</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlength</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-minlength&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minlength</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-number&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-skip&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxweight</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-maxweight&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxweight</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minweight</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-minweight&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minweight</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-inverse&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ends_only</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-ends_only&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tck_weights_in</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-tck_weights_in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tck_weights_in</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tck_weights_out</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-tck_weights_out&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tck_weights_out</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">mrtrix</span><span class="o">.</span><span class="n">mrtrix_call</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="FilteringTrack">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.FilteringTrack">[docs]</a>
<span class="k">class</span> <span class="nc">FilteringTrack</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Filter a whole-brain fibre-tracking data set such that the streamline</span>
<span class="sd">    densities match the FOD lobe integrals.</span>
<span class="sd">    (tcksift command)*</span>

<span class="sd">    Please, see the complete documentation for the `FilteringTrack brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/FilteringTrack.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FilteringTrack.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.FilteringTrack.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FilteringTrack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_tracks_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input track file (a pathlike &quot;</span>
            <span class="s2">&quot;object or a string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">suffix_desc</span> <span class="o">=</span> <span class="s2">&quot;Output file suffix (a string)&quot;</span>
        <span class="n">in_fod_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input image containing the spherical harmonics of the fibre &quot;</span>
            <span class="s2">&quot;orientation distributions (a pathlike &quot;</span>
            <span class="s2">&quot;object or a string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">proc_mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Provide an image containing the processing mask weights for &quot;</span>
            <span class="s2">&quot;the model (a pathlike object or a string representing an &quot;</span>
            <span class="s2">&quot;existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">act_image_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Provide an ACT five-tissue-type segmented anatomical image &quot;</span>
            <span class="s2">&quot;to derive the processing mask (a pathlike object or a string &quot;</span>
            <span class="s2">&quot;representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">fd_scale_gm_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Provide this option (in conjunction with -act) to heuristically &quot;</span>
            <span class="s2">&quot;downsize the fibre density estimates based on the presence of GM &quot;</span>
            <span class="s2">&quot;in the vox (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">no_dilate_lut_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Do NOT dilate FOD lobe lookup tables; only map streamlines to &quot;</span>
            <span class="s2">&quot;FOD lobes if the precise tangent lies within the angular spread &quot;</span>
            <span class="s2">&quot;of that lobe (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">make_null_lobes_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Add an additional FOD lobe to each voxel, with zero integral, &quot;</span>
            <span class="s2">&quot;that covers all directions with zero / negative FOD amplitudes &quot;</span>
            <span class="s2">&quot;(a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">remove_untracked_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Remove FOD lobes that do not have any streamline density &quot;</span>
            <span class="s2">&quot;attributed to them (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">fd_thresh_value_desc</span> <span class="o">=</span> <span class="s2">&quot;Fibre density threshold (an integer)&quot;</span>
        <span class="n">term_number_value_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Number of streamlines - continue filtering until this number &quot;</span>
            <span class="s2">&quot;of streamlines remain (an integer)&quot;</span>
        <span class="p">)</span>
        <span class="n">term_ratio_value_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Termination ratio - defined as the ratio between reduction in &quot;</span>
            <span class="s2">&quot;cost function, and reduction in density of streamlines. &quot;</span>
            <span class="s2">&quot;(an integer)&quot;</span>
        <span class="p">)</span>
        <span class="n">term_mu_value_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Terminate filtering once the SIFT proportionality coefficient &quot;</span>
            <span class="s2">&quot;reaches a given value (an integer)&quot;</span>
        <span class="p">)</span>
        <span class="n">get_csv_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output statistics of execution per iteration to a .csv file &quot;</span>
            <span class="s2">&quot;(a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">get_mu_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output the final value of SIFT proportionality coefficient mu &quot;</span>
            <span class="s2">&quot;to a text file (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">get_out_selection_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output a text file containing the binary selection of streamlines&quot;</span>
            <span class="s2">&quot;(a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Output descriptions</span>
        <span class="n">tracks_out_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The output filtered tracks file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">csv_file_out_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;A csv file with the output statistics of execution per iteration &quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">mu_file_out_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The final value of SIFT proportionality coefficient mu in a text &quot;</span>
            <span class="s2">&quot;file (a pathlike object or string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">selection_file_out_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;A text file containing the binary selection of streamlines &quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing a file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_tracks&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">in_tracks_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_fod&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">in_fod_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Optional inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;suffix&quot;</span><span class="p">,</span>
            <span class="n">String</span><span class="p">(</span>
                <span class="s2">&quot;sift&quot;</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">suffix_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;proc_mask&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">proc_mask_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;act_image&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">act_image_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;fd_scale_gm&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">fd_scale_gm_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;no_dilate_lut&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">no_dilate_lut_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;make_null_lobes&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">make_null_lobes_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;remove_untracked&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">remove_untracked_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;fd_thresh_value&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">fd_thresh_value_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;term_number_value&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">term_number_value_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;term_ratio_value&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">term_ratio_value_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;term_mu_value&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">term_mu_value_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_csv_file&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_csv_file_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_mu_file&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_mu_file_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_out_selection_file&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_out_selection_file_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;tracks_out&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">tracks_out_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;csv_file_out&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">csv_file_out_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;mu_file_out&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">mu_file_out_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;selection_file_out&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">selection_file_out_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span></div>


<div class="viewcode-block" id="FilteringTrack.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.FilteringTrack.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FilteringTrack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">,</span> <span class="n">EXT_TCK</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;tracks_out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                    <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_csv_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;csv_file_out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_tcksift_stats.csv&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mu_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;mu_file_out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_tcksift_mu.txt&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_out_selection_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;selection_file_out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                        <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_tcksift_selection.txt&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;tracks_out&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_csv_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">,</span>
                    <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;csv_file_out&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mu_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">,</span>
                    <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;mu_file_out&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_out_selection_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">,</span>
                    <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;selection_file_out&quot;</span><span class="p">],</span>
                <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="FilteringTrack.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.FilteringTrack.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FilteringTrack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tcksift&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_mask</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-proc_mask&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_mask</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">act_image</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-act&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">act_image</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd_scale_gm</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-fd_scale_gm&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_dilate_lut</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-no_dilate_lut&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_null_lobes</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-make_null_lobes&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_untracked</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-remove_untracked&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd_thresh_value</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-fd_thresh&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fd_thresh_value</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">term_number_value</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-term_number&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">term_number_value</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">term_ratio_value</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-term_ratio&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">term_ratio_value</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">term_mu_value</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-term_mu&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">term_mu_value</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_csv_file</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-csv&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">csv_file_out</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mu_file</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-out_mu&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_file_out</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_out_selection_file</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-out_selection&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_file_out</span><span class="p">]</span>

        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">in_tracks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_fod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks_out</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">mrtrix</span><span class="o">.</span><span class="n">mrtrix_call</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="FitTensor">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.FitTensor">[docs]</a>
<span class="k">class</span> <span class="nc">FitTensor</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Convert diffusion-weighted images to tensor images.</span>
<span class="sd">    (dwi2tensor command)*</span>

<span class="sd">    Please, see the complete documentation for the `FitTensor brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/FitTensor.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FitTensor.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.FitTensor.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FitTensor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Nipype FitTransform process is not up to date for some option</span>
        <span class="c1"># so the &quot;args&quot; input is used for several options</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input DWI image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionnal inputs traits</span>
        <span class="n">in_mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Only perform computation within the specified binary brain &quot;</span>
            <span class="s2">&quot;mask image (a pathlike object or string representing an &quot;</span>
            <span class="s2">&quot;existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">estimate_dkt_desc</span> <span class="o">=</span> <span class="s2">&quot;Estimate diffusion kurtosis (a boolean)&quot;</span>
        <span class="n">get_predicted_signal_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Get a file with the predicted signal from the tensor fits &quot;</span>
            <span class="s2">&quot;(a boolean) &quot;</span>
        <span class="p">)</span>
        <span class="n">get_output_b0_desc</span> <span class="o">=</span> <span class="s2">&quot;Get the output b0 (a boolean)&quot;</span>
        <span class="n">ols_option_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Perform initial fit using an ordinary least-squares (OLS) fit&quot;</span>
            <span class="s2">&quot;(a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">number_of_iter_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Number of iterative reweightings for IWLS algorithm&quot;</span>
            <span class="s2">&quot;(an integer, default value is 2)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Output descriptions</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output tensor image (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">out_dkt_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Out diffusion kurtosis (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">out_b0_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Out b0 image (a pathlike object or string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">predicted_signal_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Out predicted signal &quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing a file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Optionnal inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_mask&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_mask_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;estimate_dkt&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">estimate_dkt_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_predicted_signal&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_predicted_signal_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_output_b0&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_output_b0_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;ols_option&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">ols_option_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;number_of_iter&quot;</span><span class="p">,</span>
            <span class="n">Int</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">number_of_iter_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_dkt&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_dkt_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_b0&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_b0_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;predicted_signal_file&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">predicted_signal_file_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.FitTensor&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="FitTensor.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.FitTensor.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FitTensor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT_DWI</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_dti.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predicted_signal</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;predicted_signal_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                        <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_dti_predicted_signal.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_dkt</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_dkt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                        <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_dki.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_b0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_b0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                        <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_b0.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predicted_signal</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span>
                    <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;predicted_signal_file&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_dkt</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span>
                    <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_dkt&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_b0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span>
                    <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_b0&quot;</span><span class="p">],</span>
                <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="FitTensor.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.FitTensor.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FitTensor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predicted_signal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">predicted_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_signal_file</span>
        <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ols_option</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-ols &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_iter</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-iter &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_iter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_dkt</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-dkt &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_dkt</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_b0</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-b0 &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_b0</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="Generate5ttfsl">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.Generate5ttfsl">[docs]</a>
<span class="k">class</span> <span class="nc">Generate5ttfsl</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Generate a 5TT image suitable for ACT using the selected algorithm.</span>
<span class="sd">    (5ttgen command)*</span>

<span class="sd">    Please, see the complete documentation for the `Generate5ttfsl brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/Generate5ttfsl.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Generate5ttfsl.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.Generate5ttfsl.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Generate5ttfsl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">,</span> <span class="s2">&quot;fsl&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input T1 image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionnal inputs description</span>
        <span class="n">in_mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Manually provide a brain mask, rather than deriving one in the &quot;</span>
            <span class="s2">&quot;script (a pathlike object string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">t2_image_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Provide a T2-weighted image in addition to T1w image&quot;</span>
            <span class="s2">&quot;(a pathlike object string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">no_crop_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Do NOT crop the resulting 5TT image to reduce its size &quot;</span>
            <span class="s2">&quot;(keep the same dimensions as the input image)&quot;</span>
            <span class="s2">&quot;(a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">sgm_amyg_hipp_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Represent the amygdalae and hippocampi as sub-cortical grey &quot;</span>
            <span class="s2">&quot;matter in the 5TT image (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">premasked_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Indicate that brain masking has already been applied to the &quot;</span>
            <span class="s2">&quot;input image(a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Output descriptions</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output image (a pathlike object or string representing a file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Optional inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_mask&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_mask_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;t2_image&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">t2_image_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;no_crop&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">no_crop_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;sgm_amyg_hipp&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">sgm_amyg_hipp_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;premasked&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">premasked_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.Generate5tt&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Generate5ttfsl.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.Generate5ttfsl.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Generate5ttfsl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_5tt.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="Generate5ttfsl.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.Generate5ttfsl.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Generate5ttfsl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="s2">&quot;fsl&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span>
        <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-mask &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t2_image</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-t2 &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t2_image</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">premasked</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-premasked &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_crop</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-nocrop &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgm_amyg_hipp</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-sgm_amyg_hipp &quot;</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="Generate5tt2gmwmi">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.Generate5tt2gmwmi">[docs]</a>
<span class="k">class</span> <span class="nc">Generate5tt2gmwmi</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Generate a mask image appropriate for seeding streamlines</span>
<span class="sd">    on the grey matter-white matter interface (5tt2gmwmi command)*</span>

<span class="sd">    Please, see the complete documentation for the `Generate5tt2gmwmi brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/Generate5tt2gmwmi.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Generate5tt2gmwmi.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.Generate5tt2gmwmi.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Generate5tt2gmwmi</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The input 5TT segmented anatomical image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionnal inputs description</span>
        <span class="n">in_mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Filter an input mask image according to those voxels that lie &quot;</span>
            <span class="s2">&quot;upon the grey matter - white matter boundary (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Outputs description</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The output mask image (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Optional inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_mask&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_mask_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># No nipype command for this process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span></div>


<div class="viewcode-block" id="Generate5tt2gmwmi.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.Generate5tt2gmwmi.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Generate5tt2gmwmi</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_gmwmSeed.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="Generate5tt2gmwmi.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.Generate5tt2gmwmi.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Generate5tt2gmwmi</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;5tt2gmwmi&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-mask_in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span><span class="p">]</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">mrtrix</span><span class="o">.</span><span class="n">mrtrix_call</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="MRCat">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRCat">[docs]</a>
<span class="k">class</span> <span class="nc">MRCat</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Concatenate several images into one*</span>

<span class="sd">    Please, see the complete documentation for the `MRCat brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/tools/mrtrix/MRCat.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MRCat.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRCat.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRCat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_files_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input images to concatenate (a list of items which are &quot;</span>
            <span class="s2">&quot;a pathlike object or a string representing an &quot;</span>
            <span class="s2">&quot;existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optional inputs description</span>
        <span class="n">axis_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify axis along which concatenation should be performed &quot;</span>
            <span class="s2">&quot;(an integer, default is 3)&quot;</span>
        <span class="p">)</span>

        <span class="n">out_file_name_desc</span> <span class="o">=</span> <span class="s2">&quot;Output file name (a string)&quot;</span>

        <span class="c1"># Output description</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output image (a pathlike object or string representing &quot;</span>
            <span class="s2">&quot;an existing file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_files&quot;</span><span class="p">,</span>
            <span class="n">InputMultiPath</span><span class="p">(</span>
                <span class="n">Either</span><span class="p">(</span><span class="n">File</span><span class="p">(),</span> <span class="n">List</span><span class="p">(</span><span class="n">File</span><span class="p">())),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">in_files_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Optional inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">,</span>
            <span class="n">Int</span><span class="p">(</span>
                <span class="mi">3</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">axis_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file_name&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">String</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">out_file_name_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.MRCat&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MRCat.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRCat.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRCat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_files</span><span class="p">:</span>
            <span class="n">in_ext</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">out_file_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">in_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_files</span><span class="p">:</span>
                <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext_file</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT</span><span class="p">)</span>
                <span class="n">out_file_name</span> <span class="o">+=</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_ext</span><span class="p">:</span>
                    <span class="n">in_ext</span> <span class="o">=</span> <span class="n">in_ext_file</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">in_ext</span> <span class="o">!=</span> <span class="n">in_ext_file</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">All input files should have the same &quot;</span>
                            <span class="s2">&quot;extension...!&quot;</span>
                        <span class="p">)</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>
            <span class="n">out_file_name</span> <span class="o">+=</span> <span class="s2">&quot;concatenated&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file_name</span> <span class="o">!=</span> <span class="n">Undefined</span><span class="p">:</span>
                    <span class="n">out_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">out_file_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="c1"># FIXME : out_file inherits only from first file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="MRCat.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRCat.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRCat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="MRConvert">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRConvert">[docs]</a>
<span class="k">class</span> <span class="nc">MRConvert</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Perform conversion between different file types and optionally</span>
<span class="sd">    extract a subset of the input image. (mrconvert command)*</span>

<span class="sd">    Please, see the complete documentation for the `MRConvert brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/tools/mrtrix/MRConvert.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MRConvert.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRConvert.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRConvert</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optional inputs description</span>
        <span class="n">axes_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify the axes from the input image that will be used &quot;</span>
            <span class="s2">&quot;to form the output image (a list of items which are an integer)&quot;</span>
        <span class="p">)</span>
        <span class="n">coord_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Extract data at the specified coordinates &quot;</span>
            <span class="s2">&quot;(a list of items which are a tuple of the form (axis, selection))&quot;</span>
        <span class="p">)</span>
        <span class="n">scaling_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify the data scaling parameters used to rescale the &quot;</span>
            <span class="s2">&quot;intensity values(a list of items which are a float)&quot;</span>
        <span class="p">)</span>
        <span class="n">vox_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Change the voxel dimensions reported in the output image header&quot;</span>
            <span class="s2">&quot;(a list of items which are a float or an integer)&quot;</span>
        <span class="p">)</span>
        <span class="n">out_file_format_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Format of the output image (NIFTI, NIFTI_GZ or MIF)&quot;</span>
        <span class="p">)</span>
        <span class="n">suffix_desc</span> <span class="o">=</span> <span class="s2">&quot;Output file suffix (a string, not mandatory)&quot;</span>
        <span class="c1"># FIXME: json import / export --&gt; in mia it is not the same json as</span>
        <span class="c1">#        used in BIDS, see if it is usefull/ possible to add</span>
        <span class="c1">#        thoses option</span>

        <span class="c1"># Optional base inputs description</span>
        <span class="n">bval_scale_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specifies whether the b - values should be scaled by the square &quot;</span>
            <span class="s2">&quot;of the corresponding DW gradient norm, as often required for&quot;</span>
            <span class="s2">&quot;multishell or DSI DW acquisition schemes. &quot;</span>
            <span class="s2">&quot;(yes or no)&quot;</span>
        <span class="p">)</span>
        <span class="n">grad_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Provide the diffusion-weighted gradient scheme used in the &quot;</span>
            <span class="s2">&quot;acquisition in a text file (MRTrix format) (a pathlike object &quot;</span>
            <span class="s2">&quot;or string representing an existing file) &quot;</span>
        <span class="p">)</span>
        <span class="n">in_bvec_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Bvecs file in FSL format (a pathlike object or string &quot;</span>
            <span class="s2">&quot;representing an existing file) &quot;</span>
        <span class="p">)</span>
        <span class="n">in_bval_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Bvals file in FSL format (a pathlike object or string &quot;</span>
            <span class="s2">&quot;representing an existing file) &quot;</span>
        <span class="p">)</span>
        <span class="n">export_bvec_bval_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Export bvec / bval files in FSL format (a boolean)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Output description</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output image (a pathlike object or string representing &quot;</span>
            <span class="s2">&quot;an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">out_bvec_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;bvec file in FSL format (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="n">out_bval_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;bval file in FSL format (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Optional inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file_format&quot;</span><span class="p">,</span>
            <span class="n">Enum</span><span class="p">(</span>
                <span class="s2">&quot;MIF&quot;</span><span class="p">,</span>
                <span class="s2">&quot;NIFTI&quot;</span><span class="p">,</span>
                <span class="s2">&quot;NIFTI_GZ&quot;</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">out_file_format_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">List</span><span class="p">(</span><span class="n">Int</span><span class="p">()),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">axes_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;coord&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Int</span><span class="p">(),</span> <span class="n">String</span><span class="p">()),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">coord_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;scaling&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">List</span><span class="p">(</span><span class="n">Float</span><span class="p">()),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">scaling_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;vox&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">List</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">vox_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;export_bvec_bval&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">export_bvec_bval_desc</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;suffix&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">String</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">suffix_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Optional base inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;bval_scale&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Enum</span><span class="p">(</span><span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">bval_scale_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;grad_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">grad_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_bvec&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_bvec_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_bval&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_bval_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_bvec&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_bvec_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_bval&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_bval_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span></div>


        <span class="c1"># Nipype command not used because only working</span>
        <span class="c1"># for diffusion images (with bvec / bval)</span>

        <span class="c1"># self.init_process(&quot;nipype.interfaces.mrtrix3.MRConvert&quot;)</span>

<div class="viewcode-block" id="MRConvert.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRConvert.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRConvert</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_bval</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_bvec</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_bval</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_bvec</span>
        <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">If grad_file used, do not provied bvec or bval&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_file</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_bvec</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">If grad_file used, do not provied bvec or bval&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">:</span>
                    <span class="n">fileName</span> <span class="o">+=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">:</span>
                        <span class="n">fileName</span> <span class="o">+=</span> <span class="s2">&quot;_scaled&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vox</span><span class="p">:</span>
                        <span class="n">fileName</span> <span class="o">+=</span> <span class="s2">&quot;_vox&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">:</span>
                        <span class="n">fileName</span> <span class="o">+=</span> <span class="s2">&quot;_coord&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
                        <span class="n">fileName</span> <span class="o">+=</span> <span class="s2">&quot;_axes&quot;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                    <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">EXT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_file_format</span><span class="p">],</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_bvec_bval</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_bvec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;.bvec&quot;</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_bval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;.bval&quot;</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_bvec_bval</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_bvec&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_bval&quot;</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="MRConvert.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRConvert.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRConvert</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="c1"># Nipype command not used because only working</span>
        <span class="c1"># for diffusion images (with bvec / bval)</span>

        <span class="c1"># self.process.in_file = self.in_file</span>
        <span class="c1"># self.process.out_file = self.out_file</span>
        <span class="c1"># if self.axes:</span>
        <span class="c1">#     self.process.axes = self.axes</span>
        <span class="c1"># if self.coord:</span>
        <span class="c1">#     self.process.coord = self.coord</span>
        <span class="c1"># if self.scaling:</span>
        <span class="c1">#     self.process.scaling = self.scaling</span>
        <span class="c1"># if self.vox:</span>
        <span class="c1">#     self.process.vox = self.vox</span>
        <span class="c1"># if self.grad_file:</span>
        <span class="c1">#     self.process.grad_file = self.grad_file</span>
        <span class="c1"># if self.in_bvec:</span>
        <span class="c1">#     self.process.grad_fsl = (self.in_bvec, self.in_bval)</span>
        <span class="c1"># self.process.bval_scale = self.bval_scale</span>
        <span class="c1"># if self.export_bvec_bval:</span>
        <span class="c1">#     self.process.out_bvec = self.out_bvec</span>
        <span class="c1">#     self.process.out_bval = self.out_bval</span>

        <span class="c1"># return self.process.run(configuration_dict={})</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mrconvert&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-axes&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">:</span>
            <span class="n">axis</span><span class="p">,</span> <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-coord&quot;</span><span class="p">,</span> <span class="n">coord</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">:</span>
            <span class="n">scaling</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">:</span>
                <span class="n">scaling</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-scaling&quot;</span><span class="p">,</span> <span class="n">scaling</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vox</span><span class="p">:</span>
            <span class="n">vox</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vox</span><span class="p">:</span>
                <span class="n">vox</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-vox&quot;</span><span class="p">,</span> <span class="n">vox</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_file</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-grad&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_file</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_bvec</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-fslgrad&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_bvec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_bval</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bval_scale</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-bvalue_scaling&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bval_scale</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_bvec_bval</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-export_grad_fsl&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_bvec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_bval</span><span class="p">]</span>

        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_file</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">mrtrix</span><span class="o">.</span><span class="n">mrtrix_call</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="MRDeGibbs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRDeGibbs">[docs]</a>
<span class="k">class</span> <span class="nc">MRDeGibbs</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Remove Gibbs ringing artifacts. (mrdegibbs command)*</span>

<span class="sd">    Please, see the complete documentation for the `MRDeGibbs brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/MRDeGibbs.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MRDeGibbs.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRDeGibbs.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRDeGibbs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input DWI image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionnal inputs description</span>
        <span class="n">axes_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Indicate the plane in which the data was acquire. &quot;</span>
            <span class="s2">&quot;(a list of items which are an integer, &quot;</span>
            <span class="s2">&quot;axial = [0, 1] ; coronal = [0, 2]; sagittal = [1, 2])&quot;</span>
        <span class="p">)</span>
        <span class="n">maxW_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Right border of window used for total variation (TV) &quot;</span>
            <span class="s2">&quot;computation (an integer, default is 3)&quot;</span>
        <span class="p">)</span>
        <span class="n">minW_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Left border of window used for total variation (TV) &quot;</span>
            <span class="s2">&quot;computation (an integer, default is 1)&quot;</span>
        <span class="p">)</span>
        <span class="n">nshifts_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Discretization of subpixel spacing (an integer, default is 20)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Outputs description</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The output unringed DWI image (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">,</span>
            <span class="n">List</span><span class="p">(</span>
                <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">trait</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                <span class="n">minlen</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">maxlen</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">axes_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;maxW&quot;</span><span class="p">,</span>
            <span class="n">Int</span><span class="p">(</span>
                <span class="mi">3</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">maxW_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;minW&quot;</span><span class="p">,</span>
            <span class="n">Int</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">minW_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;nshifts&quot;</span><span class="p">,</span>
            <span class="n">Int</span><span class="p">(</span>
                <span class="mi">20</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">nshifts_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.MRDeGibbs&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MRDeGibbs.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRDeGibbs.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRDeGibbs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT_DWI</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_unringed.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="MRDeGibbs.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRDeGibbs.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRDeGibbs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">maxW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">minW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">nshifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nshifts</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="MRMath">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRMath">[docs]</a>
<span class="k">class</span> <span class="nc">MRMath</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Compute summary statistic on image intensities along a</span>
<span class="sd">    specified axis of a single image (mrmath command)*</span>

<span class="sd">    Please, see the complete documentation for the `MRMath brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/tools/mrtrix/MRMath.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MRMath.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRMath.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRMath</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input image (a pathlike object or a string representing an &quot;</span>
            <span class="s2">&quot;existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">operation_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Operation to computer along a specified axis &quot;</span>
            <span class="s2">&quot;(mean or median or sum or product or rms or norm or var or std &quot;</span>
            <span class="s2">&quot;or min or max or absmax or magmax)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optional inputs description</span>
        <span class="n">axis_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify axis along which concatenation should be performed &quot;</span>
            <span class="s2">&quot;(an integer, default is 3)&quot;</span>
        <span class="p">)</span>
        <span class="n">out_file_name_desc</span> <span class="o">=</span> <span class="s2">&quot;Output file name (a string)&quot;</span>
        <span class="c1"># Output description</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output image (a pathlike object or string representing &quot;</span>
            <span class="s2">&quot;an existing file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
            <span class="n">Enum</span><span class="p">(</span>
                <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
                <span class="s2">&quot;median&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product&quot;</span><span class="p">,</span>
                <span class="s2">&quot;rms&quot;</span><span class="p">,</span>
                <span class="s2">&quot;norm&quot;</span><span class="p">,</span>
                <span class="s2">&quot;var&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sdt&quot;</span><span class="p">,</span>
                <span class="s2">&quot;min&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max&quot;</span><span class="p">,</span>
                <span class="s2">&quot;absmax&quot;</span><span class="p">,</span>
                <span class="s2">&quot;absmin&quot;</span><span class="p">,</span>
                <span class="s2">&quot;magmax&quot;</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">operation_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Optional inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">,</span>
            <span class="n">Int</span><span class="p">(</span>
                <span class="mi">3</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">axis_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file_name&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">String</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">out_file_name_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.MRMath&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MRMath.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRMath.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRMath</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file_name</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file_name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="MRMath.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRMath.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRMath</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="MRTransform">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRTransform">[docs]</a>
<span class="k">class</span> <span class="nc">MRTransform</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Apply spatial transformations or reslice images (mrtransform command)*</span>

<span class="sd">    Please, see the complete documentation for the `MRTransform brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/MRTransform.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MRTransform.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRTransform.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRTransform</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Nipype MRTransform process is not up to date for some option</span>
        <span class="c1"># so the &quot;args&quot; input is used for several options</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input images to be transformed (a &quot;</span>
            <span class="s2">&quot;pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionnal inputs description</span>
        <span class="n">linear_transform_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify a linear transform to apply &quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file) &quot;</span>
        <span class="p">)</span>
        <span class="n">inverse_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Invert the specified transform before using it (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">flip_axes_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Flip the specified axes (a list of int with 0:x, 1:y and 2:z)&quot;</span>
        <span class="p">)</span>
        <span class="n">half_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Apply the matrix square root of the transformation (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">replace_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Replace the linear transform of the original image by that &quot;</span>
            <span class="s2">&quot;specified, rather than applying it to the original image &quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">identity_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Set the header transform of the image to the identity matrix&quot;</span>
            <span class="s2">&quot;(a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">template_image_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Reslice the input image to match the specified template image. &quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">midway_space_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Reslice the input image to the midway space. Requires either the &quot;</span>
            <span class="s2">&quot;-template or -warp option. (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">interpolation_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Set the interpolation method to use when reslicing &quot;</span>
            <span class="s2">&quot;(cubic, nearest, linear, sinc)&quot;</span>
        <span class="p">)</span>
        <span class="n">oversample_factor_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Set the amount of over-sampling (in the target space) to perform &quot;</span>
            <span class="s2">&quot;when regridding (an integer or a list of 3 integers)&quot;</span>
        <span class="p">)</span>
        <span class="n">warp_image_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Apply a non-linear 4D deformation field to warp the input image&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">warp_full_image_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Warp the input image using a 5D warp file output from mrregister&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">fod_modulate_desc</span> <span class="o">=</span> <span class="s2">&quot;Intensity modulation method for fod (fod or jac)&quot;</span>
        <span class="n">fod_directions_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Directions defining the number and orientation of the apodised&quot;</span>
            <span class="s2">&quot;point spread functions used in FOD reorientation&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">fod_reorient_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify whether to perform FOD reorientation (a boolean)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Outputs description</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The output image of the transformation.&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing an existing file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Optional inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;linear_transform&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">linear_transform_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;inverse&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">inverse_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;half&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">half_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;identity&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">identity_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;flip_axes&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">List</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">flip_axes_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;replace_file&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">replace_file_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;template_image&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">template_image_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;midway_space&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">midway_space_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;interpolation&quot;</span><span class="p">,</span>
            <span class="n">Enum</span><span class="p">(</span>
                <span class="s2">&quot;cubic&quot;</span><span class="p">,</span>
                <span class="s2">&quot;nearest&quot;</span><span class="p">,</span>
                <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sinc&quot;</span><span class="p">,</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">interpolation_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;oversample_factor&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">List</span><span class="p">(</span><span class="n">Int</span><span class="p">()),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">oversample_factor_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;warp_image&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">warp_image_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;warp_full_image&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">warp_full_image_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;fod_modulate&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Enum</span><span class="p">(</span><span class="s2">&quot;fod&quot;</span><span class="p">,</span> <span class="s2">&quot;jac&quot;</span><span class="p">),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">fod_modulate_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;fod_directions_file&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">fod_directions_file_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;fod_reorient&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">fod_reorient_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.MRTransform&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MRTransform.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRTransform.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRTransform</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_transformed.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="MRTransform.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MRTransform.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MRTransform</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_transform</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">linear_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_transform</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">invert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_image</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">template_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_image</span>
        <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flip_axes</span><span class="p">:</span>
            <span class="n">flip</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flip_axes</span><span class="p">:</span>
                <span class="n">flip</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-flip &quot;</span> <span class="o">+</span> <span class="n">flip</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">half</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-half &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_file</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-replace &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_file</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">identity</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-identity &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">midway_space</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-midway_space &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-interp &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oversample_factor</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oversample_factor</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">oversample_factor</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">oversample_factor</span><span class="p">:</span>
                    <span class="n">oversample_factor</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                <span class="n">oversample_factor</span> <span class="o">=</span> <span class="n">oversample_factor</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">oversample_factor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oversample_factor</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-oversample &quot;</span> <span class="o">+</span> <span class="n">oversample_factor</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp_image</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-warp &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp_image</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp_full_image</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-warp_full &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp_full_image</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fod_modulate</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-modulate &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fod_modulate</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fod_directions_file</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-directions &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fod_directions_file</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fod_reorient</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-reorient_fod &quot;</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="MTNormalise">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MTNormalise">[docs]</a>
<span class="k">class</span> <span class="nc">MTNormalise</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Multi-tissue informed log-domain intensity normalisation.</span>
<span class="sd">    (mtnormalise command)*</span>

<span class="sd">    Please, see the complete documentation for the `MTNormalise brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/MTNormalise.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MTNormalise.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MTNormalise.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MTNormalise</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>
        <span class="c1"># process nit in nipype</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_files_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input tissue component (a list of items which are a pathlike &quot;</span>
            <span class="s2">&quot;object or a string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The mask defines the data used to compute the intensity &quot;</span>
            <span class="s2">&quot;normalisation (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionnal inputs description</span>
        <span class="n">order_number_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The maximum order of the polynomial basis used to fit the &quot;</span>
            <span class="s2">&quot;normalisation field in the log-domain. &quot;</span>
            <span class="s2">&quot;(an integer, default is 3)&quot;</span>
        <span class="p">)</span>
        <span class="n">niter_number_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Number of iteration (an integer or a list of integer, &quot;</span>
            <span class="s2">&quot;default is [15, 7])&quot;</span>
        <span class="p">)</span>
        <span class="n">reference_number_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The (positive) reference value to which the summed tissue &quot;</span>
            <span class="s2">&quot;compartments will be normalised (a float, default is 0.282095) &quot;</span>
        <span class="p">)</span>
        <span class="n">balanced_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Incorporate the per-tissue balancing factors into scaling of &quot;</span>
            <span class="s2">&quot;the output images (a boolean)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Outputs description</span>
        <span class="n">out_files_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Nomalised outputs images (a list of items which are a pathlike &quot;</span>
            <span class="s2">&quot;object or string representing a file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_files&quot;</span><span class="p">,</span>
            <span class="n">InputMultiPath</span><span class="p">(</span>
                <span class="n">Either</span><span class="p">(</span><span class="n">File</span><span class="p">(),</span> <span class="n">List</span><span class="p">(</span><span class="n">File</span><span class="p">())),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">in_files_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">mask_desc</span><span class="p">))</span>

        <span class="c1"># Optional inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;order_number&quot;</span><span class="p">,</span>
            <span class="n">Int</span><span class="p">(</span>
                <span class="mi">3</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">order_number_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;niter_number&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">List</span><span class="p">(</span><span class="n">Int</span><span class="p">()),</span>
                <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">niter_number_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;reference_number&quot;</span><span class="p">,</span>
            <span class="n">Float</span><span class="p">(</span>
                <span class="mf">0.282095</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">reference_number_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;balanced&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">balanced_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_files&quot;</span><span class="p">,</span>
            <span class="n">OutputMultiPath</span><span class="p">(</span>
                <span class="n">Either</span><span class="p">(</span><span class="n">List</span><span class="p">(</span><span class="n">File</span><span class="p">()),</span> <span class="n">File</span><span class="p">()),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">out_files_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span></div>


<div class="viewcode-block" id="MTNormalise.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MTNormalise.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MTNormalise</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">in_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_files</span><span class="p">:</span>
                <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT_DWI</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                    <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_norm.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_file</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                        <span class="n">in_file</span><span class="p">,</span>
                        <span class="n">out_file</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="MTNormalise.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.MTNormalise.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MTNormalise</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mtnormalise&quot;</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">in_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_files</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="n">in_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_files</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-mask&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_number</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-order&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order_number</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">niter_number</span><span class="p">:</span>
            <span class="n">niter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">niter_number</span><span class="p">:</span>
                <span class="n">niter</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-niter&quot;</span><span class="p">,</span> <span class="n">niter</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_number</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-reference&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_number</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">balanced</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-balanced&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">mrtrix</span><span class="o">.</span><span class="n">mrtrix_call</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ResponseSDDhollander">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.ResponseSDDhollander">[docs]</a>
<span class="k">class</span> <span class="nc">ResponseSDDhollander</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Estimate response function(s) for spherical deconvolution using</span>
<span class="sd">    the Dhollander algorithm (dwi2response command)*</span>

<span class="sd">    Please, see the complete documentation for the `ResponseSDDhollander brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/ResponseSDDhollander.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ResponseSDDhollander.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.ResponseSDDhollander.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ResponseSDDhollander</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input DWI image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionnal inputs description</span>
        <span class="n">erode_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Number of erosion passes to apply to initial (whole brain) mask. &quot;</span>
            <span class="s2">&quot;Set to 0 to not erode the brain mask. (an intefer, default is 3)&quot;</span>
        <span class="p">)</span>
        <span class="n">fa_thresh_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;FA threshold for crude WM versus GM-CSF separation&quot;</span>
            <span class="s2">&quot;(a float, default is 0.2)&quot;</span>
        <span class="p">)</span>
        <span class="n">get_final_voxels_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Get an image showing the final voxel selection(s) (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">in_mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Provide initial mask image.(a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">max_sh_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Maximum harmonic degree of response function (a single &quot;</span>
            <span class="s2">&quot;value for single-shell response and a list for multi-shell &quot;</span>
            <span class="s2">&quot;response. (a list of items which are an integer) &quot;</span>
        <span class="p">)</span>
        <span class="n">wm_algo_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Use external dwi2response algorithm for WM single-fibre voxel &quot;</span>
            <span class="s2">&quot;selection (fa, tax, tournier)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Outputs description</span>
        <span class="n">csf_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output CSF response text file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="n">gm_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output GM response text file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>

        <span class="n">wm_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output WM response text file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="n">voxels_image_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Image showing the final voxel selection (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;erode&quot;</span><span class="p">,</span>
            <span class="n">Int</span><span class="p">(</span>
                <span class="mi">3</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">erode_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;fa_thresh&quot;</span><span class="p">,</span>
            <span class="n">Float</span><span class="p">(</span>
                <span class="mf">0.2</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">fa_thresh_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_final_voxels&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_final_voxels_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_mask&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">in_mask_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;max_sh&quot;</span><span class="p">,</span>
            <span class="n">List</span><span class="p">(</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">max_sh_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;wm_algo&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Enum</span><span class="p">(</span><span class="s2">&quot;fa&quot;</span><span class="p">,</span> <span class="s2">&quot;tax&quot;</span><span class="p">,</span> <span class="s2">&quot;tournier&quot;</span><span class="p">),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">wm_algo_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;csf_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">csf_file_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;gm_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">gm_file_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;wm_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">wm_file_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;voxels_image&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">voxels_image_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.ResponseSD&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ResponseSDDhollander.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.ResponseSDDhollander.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ResponseSDDhollander</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT_DWI</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;csf_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_response_csf.txt&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;gm_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_response_gm.txt&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;wm_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_response_wm.txt&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_final_voxels</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;voxels_image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                        <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_response_voxels.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;csf_file&quot;</span><span class="p">,</span> <span class="s2">&quot;gm_file&quot;</span><span class="p">,</span> <span class="s2">&quot;wm_file&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_final_voxels</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;voxels_image&quot;</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="ResponseSDDhollander.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.ResponseSDDhollander.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ResponseSDDhollander</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="s2">&quot;dhollander&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">csf_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csf_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">gm_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">wm_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wm_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_sh</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">max_sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_sh</span>

        <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">erode</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-erode &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">erode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_thresh</span> <span class="o">!=</span> <span class="mf">0.2</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-fa &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_thresh</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wm_algo</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-wm_algo &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">wm_algo</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_final_voxels</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-voxels &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">voxels_image</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="SphericalHarmonicExtraction">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.SphericalHarmonicExtraction">[docs]</a>
<span class="k">class</span> <span class="nc">SphericalHarmonicExtraction</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Extract the peaks of a spherical harmonic function in each voxel.</span>
<span class="sd">    (sh2peaks command)*</span>

<span class="sd">    Please, see the complete documentation for the</span>
<span class="sd">    `SphericalHarmonicExtraction brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/SphericalHarmonicExtraction.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SphericalHarmonicExtraction.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.SphericalHarmonicExtraction.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SphericalHarmonicExtraction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_SH_coeff_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The input image of SH coefficients (a pathlike &quot;</span>
            <span class="s2">&quot;object or a string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">suffix_desc</span> <span class="o">=</span> <span class="s2">&quot;Output file suffix (a string)&quot;</span>
        <span class="n">num_desc</span> <span class="o">=</span> <span class="s2">&quot;The number of peaks to extract (an integer)&quot;</span>
        <span class="n">direction_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The direction of a peak to estimate (phi, theta) &quot;</span>
            <span class="s2">&quot;(a tuple of the form (a Float, a Float)) &quot;</span>
        <span class="p">)</span>
        <span class="n">peaks_image_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The program will try to find the peaks that most closely match &quot;</span>
            <span class="s2">&quot;those in the image provided.  (a pathlike &quot;</span>
            <span class="s2">&quot;object or a string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">thresh_value_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Only peak amplitudes greater than the threshold will be &quot;</span>
            <span class="s2">&quot;considered. (a float)&quot;</span>
        <span class="p">)</span>
        <span class="n">seeds_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify a set of directions from which to start the multiple &quot;</span>
            <span class="s2">&quot;restarts of the optimisation (a pathlike object or a string &quot;</span>
            <span class="s2">&quot;representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">mask_image_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Only perform computation within the specified binary brain &quot;</span>
            <span class="s2">&quot;mask image. (a pathlike object or a string representing &quot;</span>
            <span class="s2">&quot;an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">fast_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Use lookup table to compute associated Legendre polynomials &quot;</span>
            <span class="s2">&quot;(faster, but approximate). (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Output descriptions</span>
        <span class="n">output_image_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The output image. Each volume corresponds to the x, y &amp; z &quot;</span>
            <span class="s2">&quot;component of each peak direction vector in turn. &quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing a file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_SH_coeff&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">in_SH_coeff_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Optional inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;suffix&quot;</span><span class="p">,</span>
            <span class="n">String</span><span class="p">(</span>
                <span class="s2">&quot;peaks&quot;</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">suffix_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;num&quot;</span><span class="p">,</span>
            <span class="n">Int</span><span class="p">(</span>
                <span class="mi">3</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">num_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;direction&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">direction_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;peaks_image&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">peaks_image_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;thresh_value&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Float</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">thresh_value_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;seeds_file&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">seeds_file_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;mask_image&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">mask_image_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;fast&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">fast_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;output_image&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">output_image_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span></div>


<div class="viewcode-block" id="SphericalHarmonicExtraction.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.SphericalHarmonicExtraction.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SphericalHarmonicExtraction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_SH_coeff</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_SH_coeff</span><span class="p">,</span> <span class="n">EXT_DWI</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;output_image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
                    <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_SH_coeff</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;output_image&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="SphericalHarmonicExtraction.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.SphericalHarmonicExtraction.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SphericalHarmonicExtraction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sh2peaks&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-num&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="p">:</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-direction&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks_image</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-peaks&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks_image</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresh_value</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-threshold&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresh_value</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seeds_file</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-seeds&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seeds_file</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_image</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-mask&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_image</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-fast&quot;</span><span class="p">]</span>

        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">in_SH_coeff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_image</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">mrtrix</span><span class="o">.</span><span class="n">mrtrix_call</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TensorMetrics">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.TensorMetrics">[docs]</a>
<span class="k">class</span> <span class="nc">TensorMetrics</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Compute metrics from tensors (tensor2metric command)*</span>

<span class="sd">    Please, see the complete documentation for the `TensorMetrics brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/TensorMetrics.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TensorMetrics.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.TensorMetrics.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TensorMetrics</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_dti_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input DTI image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionnal inputs description</span>
        <span class="n">component_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify the desired eigenvalue/eigenvector(s) &quot;</span>
            <span class="s2">&quot;(a list of items which are any value)&quot;</span>
        <span class="p">)</span>

        <span class="n">in_mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Only perform computation within the specified binary brain mask &quot;</span>
            <span class="s2">&quot;image.(a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">modulate_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify how to modulate the magnitude of the eigenvectors. &quot;</span>
            <span class="s2">&quot;(FA, none or eigval)&quot;</span>
        <span class="p">)</span>
        <span class="n">get_ad_desc</span> <span class="o">=</span> <span class="s2">&quot;Get AD file (a boolean, default is False)&quot;</span>
        <span class="n">get_adc_desc</span> <span class="o">=</span> <span class="s2">&quot;Get ADC file (a boolean, default is True)&quot;</span>
        <span class="n">get_cl_desc</span> <span class="o">=</span> <span class="s2">&quot;Get CL file (a boolean, default is False)&quot;</span>
        <span class="n">get_cp_desc</span> <span class="o">=</span> <span class="s2">&quot;Get CP file (a boolean, default is False)&quot;</span>
        <span class="n">get_cs_desc</span> <span class="o">=</span> <span class="s2">&quot;Get CS file (a boolean, default is False)&quot;</span>
        <span class="n">get_value_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Get selected eigenvalue(s) (a boolean, default is False)&quot;</span>
        <span class="p">)</span>
        <span class="n">get_vector_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Get selected eigenvector(s) (a boolean, default is True)&quot;</span>
        <span class="p">)</span>
        <span class="n">get_fa_desc</span> <span class="o">=</span> <span class="s2">&quot;Get FA file (a boolean, default is True)&quot;</span>
        <span class="n">get_rd_desc</span> <span class="o">=</span> <span class="s2">&quot;Get RD file (a boolean, default is False)&quot;</span>

        <span class="c1"># Outputs description</span>
        <span class="n">adc_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output ADC file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="n">fa_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output FA file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="n">ad_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output AD file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="n">rd_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output RD file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="n">cl_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output CL file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="n">cp_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output CP file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="n">cs_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output CS file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="n">value_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output selected eigenvalue(s) file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="n">vector_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output selected eigenvector(s) file (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_dti&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_dti_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Optional inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_mask&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_mask_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;component&quot;</span><span class="p">,</span>
            <span class="n">List</span><span class="p">(</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">component_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;modulate&quot;</span><span class="p">,</span>
            <span class="n">Enum</span><span class="p">(</span>
                <span class="s2">&quot;FA&quot;</span><span class="p">,</span>
                <span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="s2">&quot;eigval&quot;</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">modulate_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_adc&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_adc_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_fa&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_fa_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_ad&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_ad_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_rd&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_rd_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_cl&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_cl_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_cp&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_cp_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_cl&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_cl_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_cs&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_cs_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_value&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_value_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;get_vector&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">get_vector_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;adc_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">adc_file_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;fa_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">fa_file_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;ad_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">ad_file_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;rd_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">rd_file_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;cl_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">cl_file_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;cp_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">cp_file_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;cs_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">cs_file_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;value_file&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">value_file_desc</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;vector_file&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">vector_file_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.TensorMetrics&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TensorMetrics.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.TensorMetrics.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TensorMetrics</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="p">,</span> <span class="n">EXT_DWI</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_adc</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;adc_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s2">&quot;_dti&quot;</span><span class="p">,</span> <span class="s2">&quot;_adc&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fa</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;fa_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s2">&quot;_dti&quot;</span><span class="p">,</span> <span class="s2">&quot;_fa&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ad</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;ad_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s2">&quot;_dti&quot;</span><span class="p">,</span> <span class="s2">&quot;_ad&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rd</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;rd_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s2">&quot;_dti&quot;</span><span class="p">,</span> <span class="s2">&quot;_rd&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cl</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;cl_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s2">&quot;_dti&quot;</span><span class="p">,</span> <span class="s2">&quot;_cl&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cp</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;cp_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s2">&quot;_dti&quot;</span><span class="p">,</span> <span class="s2">&quot;_cp&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;cs_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s2">&quot;_dti&quot;</span><span class="p">,</span> <span class="s2">&quot;_cs&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cp</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;cp_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s2">&quot;_dti&quot;</span><span class="p">,</span> <span class="s2">&quot;_cp&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;value_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s2">&quot;_dti&quot;</span><span class="p">,</span> <span class="s2">&quot;_value&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vector</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;vector_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s2">&quot;_dti&quot;</span><span class="p">,</span> <span class="s2">&quot;_vector&quot;</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_adc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;adc_file&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fa</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;fa_file&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ad</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;ad_file&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;rd_file&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cl</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;cl_file&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;cp_file&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;cs_file&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;value_file&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vector</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;vector_file&quot;</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="TensorMetrics.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.TensorMetrics.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TensorMetrics</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dti</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">modulate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modulate</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mask</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_adc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_adc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adc_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fa</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_fa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ad</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_ad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ad_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_cl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cl_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_cp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vector</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_evec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_file</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="Tractography">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.Tractography">[docs]</a>
<span class="k">class</span> <span class="nc">Tractography</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Performs streamlines tractography after selecting the appropriate</span>
<span class="sd">    algorithm. (tckgen command)*</span>

<span class="sd">    Please, see the complete documentation for the `Tractography brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/Tractography.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Tractography.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.Tractography.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Tractography</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Input file to be processed (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionnal inputs description</span>
        <span class="n">algorithm_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Tractography algorithm to be used (iFOD2, FACT, iFOD1, &quot;</span>
            <span class="s2">&quot;Nulldist, SD_Stream, Tensor_Det or Tensor_Prob)&quot;</span>
        <span class="p">)</span>
        <span class="n">angle_desc</span> <span class="o">=</span> <span class="s2">&quot;Set the maximum angle between successive steps (a float)&quot;</span>
        <span class="n">cutoff_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Set the FA or FOD amplitude cutoff for terminating tracks &quot;</span>
        <span class="p">)</span>
        <span class="n">downsample_factor_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Downsample the generated streamlines to reduce output &quot;</span>
            <span class="s2">&quot;file size (a float)&quot;</span>
        <span class="p">)</span>
        <span class="n">max_length_desc</span> <span class="o">=</span> <span class="s2">&quot;Set the max length of any track in mm (a float)&quot;</span>
        <span class="n">min_length_desc</span> <span class="o">=</span> <span class="s2">&quot;Set the minimum length of any track in mm (a float)&quot;</span>
        <span class="n">noprecompt_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Do NOT pre-compute legendre polynomial values (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">select_desc</span> <span class="o">=</span> <span class="s2">&quot;Set the desired number of tracks. (an integer)&quot;</span>
        <span class="n">step_size_desc</span> <span class="o">=</span> <span class="s2">&quot;Set the step size of the algorithm in mm (a float)&quot;</span>
        <span class="n">trials_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Set the maximum number of sampling trials at each point &quot;</span>
            <span class="s2">&quot;(only used for probabilistic tracking) (an integer)&quot;</span>
        <span class="p">)</span>
        <span class="n">stop_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Stop propagating a streamline once it has traversed all include &quot;</span>
            <span class="s2">&quot;regions (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">use_rk4_desc</span> <span class="o">=</span> <span class="s2">&quot;Use 4th-order Runge-Kutta integration (a boolean)&quot;</span>
        <span class="n">seed_dynamic_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Determine seed points dynamically using the SIFT model &quot;</span>
            <span class="s2">&quot;(must not provide any other seeding mechanism).&quot;</span>
            <span class="s2">&quot;(a pathlike object string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">seed_gmwmi_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Seed from the grey matter - white matter interface &quot;</span>
            <span class="s2">&quot;(only valid if using ACT framework).&quot;</span>
            <span class="s2">&quot;(a pathlike object string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">seed_grid_voxel_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Seed a fixed number of streamlines per voxel in a mask image; &quot;</span>
            <span class="s2">&quot;place seeds on a 3D mesh grid (a tuple of the form: (a pathlike &quot;</span>
            <span class="s2">&quot;object or string representing an existing file, an integer)) &quot;</span>
        <span class="p">)</span>
        <span class="n">seed_image_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Seed streamlines entirely at random within a mask image&quot;</span>
            <span class="s2">&quot;(a pathlike object string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">seed_rejection_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Seed from an image using rejection sampling &quot;</span>
            <span class="s2">&quot;(a pathlike object string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">seed_rnd_voxel_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Seed a fixed number of streamlines per voxel in a mask image; &quot;</span>
            <span class="s2">&quot;random placement of seeds in each voxel.&quot;</span>
            <span class="s2">&quot;(a tuple of the form: (a pathlike object or string representing &quot;</span>
            <span class="s2">&quot;an existing file, an integer)) &quot;</span>
        <span class="p">)</span>
        <span class="n">seed_sphere_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Spherical seed. (a tuple of the form: (a float, a float, &quot;</span>
            <span class="s2">&quot;a float, a float)) &quot;</span>
        <span class="p">)</span>
        <span class="n">tracto_seeds_number_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Set the number of seeds that tckgen will attempt to track from. &quot;</span>
            <span class="s2">&quot;(an integer)&quot;</span>
        <span class="p">)</span>
        <span class="n">tracto_max_attempts_per_seed_number_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Set the maximum number of times that the tracking algorithm &quot;</span>
            <span class="s2">&quot;should attempt to find an appropriate tracking direction from a &quot;</span>
            <span class="s2">&quot;given seed point. (an integer, default is 1000) &quot;</span>
        <span class="p">)</span>
        <span class="n">tracto_seed_cutoff_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Set the minimum FA or FOD amplitude for seeding tracks &quot;</span>
            <span class="s2">&quot;(an integer, default is 0.1).&quot;</span>
        <span class="p">)</span>
        <span class="n">tracto_seed_unidirectional_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Track from the seed point in one direction only (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">tracto_seed_direction_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify a seeding direction for the tracking &quot;</span>
            <span class="s2">&quot;(a tuple of the form: (a float, a float, a float))&quot;</span>
        <span class="p">)</span>
        <span class="n">tracto_get_output_seeds_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Get the seed location of all successful streamlines into a file&quot;</span>
            <span class="s2">&quot;(a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">roi_excl_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify an exclusion region of interest, streamlines that enter &quot;</span>
            <span class="s2">&quot;ANY exclude region will be discarded. (a pathlike &quot;</span>
            <span class="s2">&quot;object or string representing an existing file or a tuple of the &quot;</span>
            <span class="s2">&quot;form: (a float, a float, a float, a float))&quot;</span>
        <span class="p">)</span>
        <span class="n">roi_incl_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify an inclusion region of interest, streamlines must &quot;</span>
            <span class="s2">&quot;traverse ALL inclusion regions to be accepted. (a pathlike &quot;</span>
            <span class="s2">&quot;object or string representing an existing file or a tuple of the &quot;</span>
            <span class="s2">&quot;form: (a float, a float, a float, a float))&quot;</span>
        <span class="p">)</span>
        <span class="n">roi_incl_ordered_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify an inclusion region of interest, streamlines must &quot;</span>
            <span class="s2">&quot;traverse ALL inclusion_ordered regions in the order &quot;</span>
            <span class="s2">&quot;they are specified in order to be accepted. (a pathlike &quot;</span>
            <span class="s2">&quot;object or string representing an existing file or a tuple of the &quot;</span>
            <span class="s2">&quot;form: (a float, a float, a float, a float))&quot;</span>
        <span class="p">)</span>
        <span class="n">roi_mask_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Specify a masking region of interest. If defined,streamlines &quot;</span>
            <span class="s2">&quot;exiting the mask will be truncated. (a pathlike &quot;</span>
            <span class="s2">&quot;object or string representing an existing file or a tuple of the &quot;</span>
            <span class="s2">&quot;form: (a float, a float, a float, a float))&quot;</span>
        <span class="p">)</span>
        <span class="n">act_image_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot; Use the Anatomically-Constrained Tractography &quot;</span>
            <span class="s2">&quot;framework during tracking (provided image must be &quot;</span>
            <span class="s2">&quot;in the 5TT ie five tissue type format(a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">backtrack_desc</span> <span class="o">=</span> <span class="s2">&quot;Allow tracks to be truncated. (a boolean)&quot;</span>
        <span class="n">crop_at_gmwmi_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Crop streamline endpoints more precisely as they cross the &quot;</span>
            <span class="s2">&quot;GM-WM interface (a boolean)&quot;</span>
        <span class="p">)</span>
        <span class="n">iFOD_power_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Raise the FOD to the power specified (default is 1/nsamples) &quot;</span>
            <span class="s2">&quot;(an integer)&quot;</span>
        <span class="p">)</span>
        <span class="n">iFOD2_n_samples_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Set the number of FOD samples to take per&quot;</span>
            <span class="s2">&quot;step for the 2nd order (iFOD2) method. &quot;</span>
        <span class="p">)</span>

        <span class="c1"># Outputs description</span>
        <span class="n">out_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output file containing tracks (a pathlike object or &quot;</span>
            <span class="s2">&quot;string representing a file) &quot;</span>
        <span class="p">)</span>
        <span class="n">output_seeds_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Out seed location of all successful streamlines .&quot;</span>
            <span class="s2">&quot;(a pathlike object or string representing a file) &quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Optional inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;algorithm&quot;</span><span class="p">,</span>
            <span class="n">Enum</span><span class="p">(</span>
                <span class="s2">&quot;iFOD2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;FACT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iFOD1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Nulldist&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SD_Stream&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Tensor_Det&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Tensor_Prob&quot;</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">algorithm_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;angle&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Float</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">angle_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;cutoff&quot;</span><span class="p">,</span>
            <span class="n">Float</span><span class="p">(</span>
                <span class="mf">0.1</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">cutoff_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;downsample_factor&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Float</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">downsample_factor_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;max_length&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Float</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">max_length_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;min_length&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Float</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">min_length_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;noprecompt&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">noprecompt_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;select&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">select_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;step_size&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Float</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">step_size_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;stop&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">stop_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;trials&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">trials_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;use_rk4&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">use_rk4_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;seed_dynamic&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">seed_dynamic_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;seed_gmwmi&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">seed_gmwmi_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;seed_grid_voxel&quot;</span><span class="p">,</span>
            <span class="n">Tuple</span><span class="p">(</span>
                <span class="n">File</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">seed_grid_voxel_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;seed_image&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">seed_image_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;seed_rejection&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">seed_rejection_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;seed_rnd_voxel&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">File</span><span class="p">,</span> <span class="n">Int</span><span class="p">),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">seed_rnd_voxel_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;seed_sphere&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">seed_sphere_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;tracto_seeds_number&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">tracto_seeds_number_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;tracto_max_attempts_per_seed_number&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">tracto_max_attempts_per_seed_number_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;tracto_seed_cutoff&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Float</span><span class="p">(),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">tracto_seed_cutoff_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;tracto_seed_unidirectional&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">tracto_seed_unidirectional_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;tracto_seed_direction&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">tracto_seed_direction_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;tracto_get_output_seeds&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">tracto_get_output_seeds_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;roi_excl&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">roi_excl_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;roi_incl&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">roi_incl_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;roi_incl_ordered&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">roi_incl_ordered_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;roi_mask&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">File</span><span class="p">(),</span>
                <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Float</span><span class="p">),</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">roi_mask_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;act_image&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">act_image_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;backtrack&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">backtrack_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;crop_at_gmwmi&quot;</span><span class="p">,</span>
            <span class="n">Bool</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">crop_at_gmwmi_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;iFOD_power&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">iFOD_power_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;iFOD2_n_samples&quot;</span><span class="p">,</span>
            <span class="n">Either</span><span class="p">(</span>
                <span class="n">Undefined</span><span class="p">,</span>
                <span class="n">Int</span><span class="p">(),</span>
                <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">iFOD2_n_samples_desc</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_file_desc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;output_seeds&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">output_seeds_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.Tractography&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tractography.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.Tractography.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Tractography</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">EXT_DWI</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The input image format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="c1"># TODO: add number of streamline in name ?</span>
                <span class="n">out_file_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;_tracto.tck&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">out_file_name</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracto_get_output_seeds</span><span class="p">:</span>
                    <span class="n">out_seeds_file_name</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;_tracto_out_seeds.&quot;</span> <span class="o">+</span> <span class="n">in_ext</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;output_seeds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">out_seeds_file_name</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_file&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracto_get_output_seeds</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                    <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;output_seeds&quot;</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="Tractography.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.Tractography.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Tractography</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="c1"># Nipype Tractoraphy process is not up to date for some option</span>
        <span class="c1"># so the &quot;args&quot; input is used for several options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">noprecompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noprecompt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">select</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">use_rk4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_rk4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">backtrack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backtrack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">crop_at_gmwmi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_at_gmwmi</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsample_factor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">downsample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsample_factor</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">max_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_length</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">min_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_length</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">trials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">step_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_size</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_grid_voxel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">seed_grid_voxel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_grid_voxel</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_dynamic</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">seed_dynamic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_dynamic</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_gmwmi</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">seed_gmwmi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_gmwmi</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_image</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">seed_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_image</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_rejection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">seed_rejection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_rejection</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_rnd_voxel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">seed_rnd_voxel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_rnd_voxel</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_sphere</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">seed_sphere</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_sphere</span>
        <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracto_seeds_number</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-seeds&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracto_seeds_number</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracto_max_attempts_per_seed_number</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;-max_attempts_per_seed&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracto_max_attempts_per_seed_number</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracto_seed_cutoff</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-seed_cutoff&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracto_seed_cutoff</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracto_seed_unidirectional</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-seed_unidirectional&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracto_seed_direction</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;-seed_direction&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracto_seed_direction</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi_excl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">roi_excl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi_excl</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi_incl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">roi_incl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi_incl</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi_incl_ordered</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roi_incl</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">roi_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi_mask</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">act_image</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">act_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">act_image</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iFOD_power</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iFOD_power</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iFOD2_n_samples</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iFOD2_n_samples</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracto_get_output_seeds</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_seeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_seeds</span>

        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>



<div class="viewcode-block" id="TransformFSLConvert">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.TransformFSLConvert">[docs]</a>
<span class="k">class</span> <span class="nc">TransformFSLConvert</span><span class="p">(</span><span class="n">ProcessMIA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *Perform conversion between FSL’s transformation matrix format</span>
<span class="sd">    to mrtrix3’s. (transformconvert command)*</span>

<span class="sd">    Please, see the complete documentation for the `TransformFSLConvert brick</span>
<span class="sd">    in the mia_processes website</span>
<span class="sd">    &lt;https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/mrtrix/TransformFSLConvert.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TransformFSLConvert.__init__">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.TransformFSLConvert.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the attributes initialisation/instantiation.</span>
<span class="sd">        The input and output plugs are defined here. The special</span>
<span class="sd">        &#39;self.requirement&#39; attribute (optional) is used to define the</span>
<span class="sd">        third-party products necessary for the running of the brick.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialisation of the objects needed for the launch of the brick</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TransformFSLConvert</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Third party softwares required for the execution of the brick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">]</span>

        <span class="c1"># Mandatory inputs description</span>
        <span class="n">in_file_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;FLIRT input image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">reference_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;FLIRT reference image (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>
        <span class="n">in_transform_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;FLIRT output transformation matrix (a pathlike object&quot;</span>
            <span class="s2">&quot;string representing an existing file)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Outputs description</span>
        <span class="n">out_transform_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Output transformed affine in mrtrix’s format (a pathlike object &quot;</span>
            <span class="s2">&quot;or string representing a file) &quot;</span>
        <span class="p">)</span>

        <span class="c1"># Mandatory inputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_file_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;reference&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">reference_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;in_transform&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">in_transform_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Outputs traits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;out_transform&quot;</span><span class="p">,</span>
            <span class="n">File</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">out_transform_desc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_default_traits</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_process</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.mrtrix3.TransformFSLConvert&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TransformFSLConvert.list_outputs">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.TransformFSLConvert.list_outputs">[docs]</a>
    <span class="k">def</span> <span class="nf">list_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_plugged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the initialisation step of the brick.</span>
<span class="sd">        The main objective of this method is to produce the outputs of the</span>
<span class="sd">        bricks (self.outputs) and the associated tags (self.inheritance_dic),</span>
<span class="sd">        if defined here. In order not to include an output in the database,</span>
<span class="sd">        this output must be a value of the optional key &#39;notInDb&#39; of the</span>
<span class="sd">        self.outputs dictionary. To work properly this method must return</span>
<span class="sd">        self.make_initResult() object.</span>
<span class="sd">        :param is_plugged: the state, linked or not, of the plugs.</span>
<span class="sd">        :returns: a dictionary with requirement, outputs and inheritance_dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using the inheritance to ProcessMIA class, list_outputs method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TransformFSLConvert</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>

        <span class="c1"># Outputs definition and tags inheritance (optional)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_transform</span><span class="p">:</span>
            <span class="n">valid_ext</span><span class="p">,</span> <span class="n">in_ext</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">checkFileExt</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_transform</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;MAT&quot;</span><span class="p">:</span> <span class="s2">&quot;mat&quot;</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_ext</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The transform matrice format is not recognized...!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_transform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;_mrtrix.txt&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags_inheritance</span><span class="p">(</span>
                <span class="n">in_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_transform</span><span class="p">,</span>
                <span class="n">out_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;out_transform&quot;</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="c1"># Return the requirement, outputs and inheritance_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_initResult</span><span class="p">()</span></div>


<div class="viewcode-block" id="TransformFSLConvert.run_process_mia">
<a class="viewcode-back" href="../../../../../mia_processes.bricks.preprocess.mrtrix.html#mia_processes.bricks.preprocess.mrtrix.processes.TransformFSLConvert.run_process_mia">[docs]</a>
    <span class="k">def</span> <span class="nf">run_process_mia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dedicated to the process launch step of the brick.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TransformFSLConvert</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_process_mia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">flirt_import</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">out_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_transform</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">configuration_dict</span><span class="o">=</span><span class="p">{})</span></div>
</div>

</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2019, populse.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>